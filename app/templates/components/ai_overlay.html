<!-- AI Chat Component -->

<!-- Trigger Button (In Header) -->
<button @click="showChat = !showChat"
    class="bg-[#ffb000] text-black w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center border-2 md:border-4 border-[#1a1a1a] shadow-[0_0_15px_#ffb000] hover:scale-110 transition-transform z-10 relative">
    <span class="text-xl md:text-2xl">âš¡</span>
</button>

<!-- Chat Modal (Teleported to Body for correct overlay) -->
<template x-teleport="body">
    <div x-show="showChat" style="display: none;"
        class="fixed inset-0 z-[200] flex items-end justify-end sm:items-center sm:justify-center p-4 pointer-events-none">

        <!-- Window Container -->
        <div class="pointer-events-auto bg-[#1a1a1a] border-2 border-[#ffb000] w-full max-w-lg h-[60vh] md:h-[600px] flex flex-col shadow-[0_0_50px_rgba(0,0,0,0.8)] relative rounded-t-lg md:rounded-lg overflow-hidden"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="translate-y-full opacity-0 scale-95"
            x-transition:enter-end="translate-y-0 opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-y-0 opacity-100 scale-100"
            x-transition:leave-end="translate-y-full opacity-0 scale-95">

            <!-- Header -->
            <div class="bg-[#ffb000] text-black p-2 font-bold flex justify-between items-center text-lg lg:text-xl">
                <span>STOCKMAN.AI [V1.0]</span>
                <button @click="showChat = false"
                    class="hover:bg-black hover:text-[#ffb000] px-2 font-bold transition-colors">X</button>
            </div>

            <!-- Chat History -->
            <div class="flex-grow p-4 overflow-y-auto space-y-4 font-mono text-sm lg:text-base" id="chat-history">
                <template x-for="msg in chatMessages">
                    <div>
                        <div :class="msg.role === 'user' ? 'text-right' : 'text-left text-[#33ff00]'">
                            <span class="opacity-50 text-xs uppercase"
                                x-text="msg.role === 'user' ? 'YOU:' : 'AI:'"></span>
                            <div x-text="msg.text"
                                class="bg-opacity-10 p-2 inline-block rounded max-w-[85%] break-words"
                                :class="msg.role === 'user' ? 'bg-[#ffb000] text-[#ffb000] border border-[#ffb000]' : 'bg-[#33ff00] text-[#33ff00] border border-[#33ff00]'">
                            </div>
                        </div>
                    </div>
                </template>
                <div x-show="chatMessages.length === 0" class="text-center opacity-50 mt-10">
                    > SYSTEM READY.<br>
                    > AWAITING ORDERS...
                </div>
                <div x-show="chatLoading" class="text-[#33ff00]">
                    > PROCESSING... <span class="animate-pulse">_</span>
                </div>
            </div>

            <!-- Input -->
            <div class="p-2 border-t border-[#ffb000] bg-[#1a1a1a]">
                <form @submit.prevent="sendChatMessage()" class="flex gap-2">
                    <input x-model="chatInput" type="text" placeholder="Type command..."
                        class="flex-grow bg-[#111] text-[#ffb000] p-3 focus:outline-none border-b border-[#ffb000] font-mono">
                    <button type="submit"
                        class="text-[#ffb000] hover:text-black hover:bg-[#ffb000] px-6 font-bold border border-[#ffb000] transition-colors">
                        &crarr;
                    </button>
                </form>
            </div>
        </div>
    </div>
</template>